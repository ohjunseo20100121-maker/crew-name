<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>í¬ì¸íŠ¸ ìˆœìœ„</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ìƒë‹¨ë°” -->
<div class="navbar">
  <div class="nav-left">
    <button class="menu-btn" id="menuBtn">â˜°</button>
    <div id="authArea"></div>
  </div>
  <div class="logo">CHOICE CREW</div>
</div>


<!-- ì‚¬ì´ë“œ ë©”ë‰´ -->
<div class="side-menu" id="sideMenu">
  <a href="index.html">ğŸ  í™ˆ</a>
  <a href="rank.html">ğŸ† í¬ì¸íŠ¸ ìˆœìœ„</a>
  <a href="log.html">ğŸ“Š í¬ì¸íŠ¸ ë¡œê·¸</a>
  <a href="admin.html">âš™ ê´€ë¦¬ì</a>
</div>

<!-- ë­í‚¹ -->
<div class="page-wrap">
  <div class="page-title">ğŸ† í¬ì¸íŠ¸ ë­í‚¹</div>
<div class="podium" id="podium"></div>

  <table class="rank-table">
    <thead>
      <tr>
        <th>ìˆœìœ„</th>
        <th>ì´ë¦„</th>
        <th>í¬ì¸íŠ¸</th>
      </tr>
    </thead>
    <tbody id="rankList"></tbody>
  </table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getFirestore,
  doc,
  getDoc,
  collection,
  query,
  orderBy,
  getDocs
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";


const firebaseConfig = {
  apiKey: "AIzaSyDn_NwSI3bQw-qSf__CmXugu7gjRKrlAvc",
  authDomain: "crew-point.firebaseapp.com",
  projectId: "crew-point",
  appId: "1:961636624576:web:f56d961665ed394e39a525"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const authArea = document.getElementById("authArea");
const uid = localStorage.getItem("uid");

if (!uid) {
  // ë¡œê·¸ì¸ ì•ˆ ë¨
  authArea.innerHTML = `
    <a href="login.html">ë¡œê·¸ì¸</a>
    <a href="signup.html">íšŒì›ê°€ì…</a>
  `;
} else {
  const snap = await getDoc(doc(db, "users", uid));
  if (snap.exists()) {
    const name = snap.data().name;
    authArea.innerHTML = `
      <span>${name}ë‹˜</span>
      <button id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
    `;

    document.getElementById("logoutBtn").onclick = () => {
      localStorage.clear();
      location.href = "login.html";
    };
  }
}

/* ë©”ë‰´ ë²„íŠ¼ */
menuBtn.onclick = () => {
  document.getElementById("sideMenu").classList.toggle("active");
};

// ===== ë­í‚¹ ë¶ˆëŸ¬ì˜¤ê¸° =====
const podium = document.getElementById("podium");
const rankList = document.getElementById("rankList");

const q = query(
  collection(db, "users"),
  orderBy("point", "desc")
);

const snapRank = await getDocs(q);

let rank = 1;

snapRank.forEach(docu => {
  const d = docu.data();
  const point = d.point || 0;

  // ğŸ† TOP 3 â†’ ì‹œìƒëŒ€
  if (rank <= 3) {
    const medal =
      rank === 1 ? "ğŸ‘‘" :
      rank === 2 ? "ğŸ¥ˆ" : "ğŸ¥‰";

    podium.innerHTML += `
      <div class="podium-card rank-${rank}">
        <div class="medal">${medal}</div>
        <div class="name">${d.name}</div>
        <div class="point">${point} P</div>
        <div class="rank">${rank}ìœ„</div>
      </div>
    `;
  }
  // ğŸ“‹ 4ë“±ë¶€í„° â†’ í…Œì´ë¸”
  else {
    rankList.innerHTML += `
      <tr>
        <td>${rank}</td>
        <td>${d.name}</td>
        <td>${point} P</td>
      </tr>
    `;
  }

  rank++;
});

</script>


</body>
</html>
