<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>íšŒì›ê°€ì…</title>

  <!-- â— ì¼ë‹¨ í™”ë©´ ì•ˆ ë‚˜ì˜¤ëŠ” ë¬¸ì œ ë°©ì§€ìš© -->
  <!-- ë‚˜ì¤‘ì— ë””ìì¸í•  ë•Œ ë‹¤ì‹œ ì¨ë„ ë¨ -->
  <!-- <link rel="stylesheet" href="style.css"> -->
</head>

<body>

<div class="container">
  <h2>íšŒì›ê°€ì…</h2>

  <input id="email" type="email" placeholder="ì´ë©”ì¼"><br><br>
  <input id="pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)"><br><br>
  <input id="name" type="text" placeholder="ë‹‰ë„¤ì„"><br><br>

  <button id="btn">íšŒì›ê°€ì…</button>
</div>

<!-- ğŸ”½ ë°˜ë“œì‹œ body ë§¨ ì•„ë˜ -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, serverTimestamp }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  // âœ… Firebase ì„¤ì •
  const firebaseConfig = {
    apiKey: "AIzaSyDn_NwSI3bQw-qSf__CmXugu7gjRKrlAvc",
    authDomain: "crew-point.firebaseapp.com",
    projectId: "crew-point",
    appId: "1:961636624576:web:f56d961665ed394e39a525"
  };

  // âœ… ì´ˆê¸°í™”
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // âœ… ë²„íŠ¼ í´ë¦­
  document.getElementById("btn").addEventListener("click", async () => {
    const email = document.getElementById("email").value.trim();
    const pw = document.getElementById("pw").value;
    const name = document.getElementById("name").value.trim();

    // âœ… ê¸°ë³¸ ê²€ì¦
    if (!email || !pw || !name) {
      alert("ëª¨ë“  ì¹¸ì„ ì…ë ¥í•˜ì„¸ìš”");
      return;
    }

    if (pw.length < 6) {
      alert("ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤");
      return;
    }

    try {
      // 1ï¸âƒ£ Authentication ê³„ì • ìƒì„±
      const res = await createUserWithEmailAndPassword(auth, email, pw);

      // 2ï¸âƒ£ Firestoreì— ìœ ì € ì •ë³´ ì €ì¥
      await setDoc(doc(db, "users", res.user.uid), {
        email: email,
        name: name,
        role: "user",          // ê¸°ë³¸ ê¶Œí•œ
        createdAt: serverTimestamp()
      });

      alert("íšŒì›ê°€ì… ì„±ê³µ!");
      location.href = "login.html";

    } catch (err) {
      alert(err.message);
    }
  });
</script>

</body>
</html>
